{% extends "base.html" %}

{% block page_title %}Help & Documentation{% endblock %}

{% block content %}
<!-- Quick Start Guide -->
<div class="card" style="margin-bottom: 24px;">
    <div class="card-header">
        <div class="card-title">
            <i class="fas fa-rocket"></i>
            <span>Quick Start Guide</span>
        </div>
    </div>
    <div class="card-body">
        <p style="margin-bottom: 16px;">Learn how to use Daygle Mail Archiver to fetch, store, and manage your emails.</p>
        <ol style="padding-left: 24px; margin-bottom: 0;">
            <li style="margin-bottom: 12px;"><strong>Set up a Fetch Account:</strong> Go to Settings → Fetch Accounts and add a new email account (IMAP, Gmail, or Office 365)</li>
            <li style="margin-bottom: 12px;"><strong>Enable the account:</strong> Make sure the "Enabled" checkbox is checked</li>
            <li style="margin-bottom: 12px;"><strong>Start the worker:</strong> The worker will automatically fetch emails based on the poll interval</li>
            <li style="margin-bottom: 0;"><strong>View your emails:</strong> Navigate to the Emails page to browse and search archived emails</li>
        </ol>
    </div>
</div>

<!-- Adding IMAP Accounts -->
<div class="card" style="margin-bottom: 24px;">
    <div class="card-header">
        <div class="card-title">
            <i class="fas fa-server"></i>
            <span>Adding IMAP Accounts</span>
        </div>
    </div>
    <div class="card-body">
        <ol style="padding-left: 24px; margin-bottom: 0;">
            <li style="margin-bottom: 12px;">Go to <strong>Settings → Fetch Accounts</strong> and click <strong>"Add New Account"</strong></li>
            <li style="margin-bottom: 12px;">Select <strong>"IMAP"</strong> as the account type</li>
            <li style="margin-bottom: 12px;">Enter your IMAP server details (host, port, username, password, SSL)</li>
            <li style="margin-bottom: 12px;">Set the poll interval (how often to check for new emails)</li>
            <li style="margin-bottom: 12px;">Click <strong>"Test"</strong> to verify the connection</li>
            <li style="margin-bottom: 0;">Click <strong>"Create Account"</strong> to save</li>
        </ol>
    </div>
</div>

<!-- Adding Gmail API Accounts -->
<div class="card" style="margin-bottom: 24px;">
    <div class="card-header">
        <div class="card-title">
            <i class="fab fa-google"></i>
            <span>Adding Gmail API Accounts</span>
        </div>
    </div>
    <div class="card-body">
        <ol style="padding-left: 24px; margin-bottom: 0;">
            <li style="margin-bottom: 12px;">Create a Google Cloud project and enable Gmail API</li>
            <li style="margin-bottom: 12px;">Create OAuth 2.0 credentials with redirect URI: <code>http://your-domain/oauth/gmail/callback</code></li>
            <li style="margin-bottom: 12px;">Add a new account and select <strong>"Gmail API"</strong></li>
            <li style="margin-bottom: 12px;">Enter your OAuth Client ID and Client Secret</li>
            <li style="margin-bottom: 12px;">Save the account, then click <strong>"Authorize Gmail"</strong></li>
            <li style="margin-bottom: 0;">Complete the Google authorization flow</li>
        </ol>
    </div>
</div>

<!-- Adding Office 365 Accounts -->
<div class="card" style="margin-bottom: 24px;">
    <div class="card-header">
        <div class="card-title">
            <i class="fab fa-microsoft"></i>
            <span>Adding Office 365 Accounts</span>
        </div>
    </div>
    <div class="card-body">
        <ol style="padding-left: 24px; margin-bottom: 0;">
            <li style="margin-bottom: 12px;">Register an app in Azure AD / Microsoft 365 Admin Center</li>
            <li style="margin-bottom: 12px;">Add Mail.Read permission and create a client secret</li>
            <li style="margin-bottom: 12px;">Add a new account and select <strong>"Office 365 API"</strong></li>
            <li style="margin-bottom: 12px;">Enter your OAuth Client ID and Client Secret</li>
            <li style="margin-bottom: 12px;">Save the account, then click <strong>"Authorize Office 365"</strong></li>
            <li style="margin-bottom: 0;">Complete the Microsoft authorization flow</li>
        </ol>
    </div>
</div>

<!-- Managing Emails -->
<div class="card" style="margin-bottom: 24px;">
    <div class="card-header">
        <div class="card-title">
            <i class="fas fa-inbox"></i>
            <span>Managing Emails</span>
        </div>
    </div>
    <div class="card-body">
        <p style="margin-bottom: 16px;"><strong>Viewing Emails:</strong> Navigate to the Emails page to see all archived emails. You can search, filter by folder, view full content, and download raw .eml files.</p>
        <p style="margin-bottom: 16px;"><strong>Deleting Emails:</strong> Click the delete button next to an email for individual deletion, or use "Delete All" with filters for bulk operations.</p>
        <div class="alert alert-warning" style="margin-bottom: 0;">
            <i class="fas fa-exclamation-triangle"></i> <strong>Warning:</strong> Deletions are permanent and cannot be undone!
        </div>
    </div>
</div>

<!-- Worker Status -->
<div class="card" style="margin-bottom: 24px;">
    <div class="card-header">
        <div class="card-title">
            <i class="fas fa-heartbeat"></i>
            <span>Worker Status Monitoring</span>
        </div>
    </div>
    <div class="card-body">
        <p style="margin-bottom: 16px;">The Worker Status page shows the health of your email fetch workers, including status (green=running, red=stopped), last heartbeat, number of accounts being monitored, and recent errors.</p>
        <p style="margin-bottom: 0;">If the worker status is red, check that the worker process is running and review the error logs.</p>
    </div>
</div>

<!-- Global Settings -->
<div class="card" style="margin-bottom: 24px;">
    <div class="card-header">
        <div class="card-title">
            <i class="fas fa-sliders"></i>
            <span>Global Settings</span>
        </div>
    </div>
    <div class="card-body">
        <p style="margin-bottom: 16px;"><strong>Retention Policy:</strong> Configure automatic deletion of old emails. Set retention period (days, months, years) and optionally delete from mail servers (IMAP only).</p>
        <p style="margin-bottom: 16px;"><strong>Page Size & Date Format:</strong> Control items per page in email listings and configure your preferred date/time display format.</p>
        <div class="alert alert-info" style="margin-bottom: 0;">
            <i class="fas fa-info-circle"></i> Retention cleanup runs automatically during worker cycles. All deletions are tracked on the Dashboard.
        </div>
    </div>
</div>

<!-- Dashboard Analytics -->
<div class="card" style="margin-bottom: 24px;">
    <div class="card-header">
        <div class="card-title">
            <i class="fas fa-chart-line"></i>
            <span>Dashboard & Analytics</span>
        </div>
    </div>
    <div class="card-body">
        <p style="margin-bottom: 16px;">The Dashboard provides comprehensive statistics about your email archive including email volume trends, top senders/receivers, deletion statistics, mail server deletions, and storage metrics.</p>
        <p style="margin-bottom: 0;">All charts are interactive and update in real-time based on your archive data.</p>
    </div>
</div>

<!-- Troubleshooting -->
<div class="card" style="margin-bottom: 24px;">
    <div class="card-header">
        <div class="card-title">
            <i class="fas fa-wrench"></i>
            <span>Troubleshooting</span>
        </div>
    </div>
    <div class="card-body">
        <p style="margin-bottom: 16px;"><strong>Connection Issues:</strong> Use the Test button on fetch accounts, check firewall settings, verify SSL/TLS settings, and use app-specific passwords for Gmail with 2FA.</p>
        <p style="margin-bottom: 16px;"><strong>OAuth Authorization Failed:</strong> Verify Client ID and Secret, ensure redirect URI is properly configured, check API permissions, and try re-authorizing.</p>
        <p style="margin-bottom: 16px;"><strong>No Emails Being Fetched:</strong> Check that the account is Enabled, verify the worker is running, and review error emails in the logs.</p>
        <p style="margin-bottom: 0;"><strong>Performance Issues:</strong> Reduce poll interval, enable "Delete after processing" option, or implement retention policies to limit database size.</p>
    </div>
</div>

<!-- Email Deletion Behavior -->
<div class="card" style="margin-bottom: 24px;">
    <div class="card-header">
        <div class="card-title">
            <i class="fas fa-trash-alt"></i>
            <span>Email Deletion Behavior</span>
        </div>
    </div>
    <div class="card-body">
        <p style="margin-bottom: 16px;">When "Delete Email After Processed" is enabled, emails are removed from the mail server after being archived:</p>
        <ul style="padding-left: 24px; margin-bottom: 16px;">
            <li style="margin-bottom: 8px;"><strong>IMAP:</strong> Can mark as deleted (recoverable) or permanently expunge (not recoverable)</li>
            <li style="margin-bottom: 8px;"><strong>Gmail:</strong> Moves to Trash with 30-day recovery period</li>
            <li style="margin-bottom: 8px;"><strong>Office 365:</strong> Moves to Deleted Items (recoverable until emptied)</li>
        </ul>
        <div class="alert alert-danger" style="margin-bottom: 0;">
            <i class="fas fa-exclamation-triangle"></i> <strong>Warning:</strong> The "Permanently Expunge Deleted" option for IMAP accounts irreversibly removes emails from the server. Use with extreme caution!
        </div>
    </div>
</div>

<!-- Additional Resources -->
<div class="card">
    <div class="card-header">
        <div class="card-title">
            <i class="fas fa-book"></i>
            <span>Additional Resources</span>
        </div>
    </div>
    <div class="card-body">
        <ul style="padding-left: 24px; margin-bottom: 0;">
            <li style="margin-bottom: 8px;"><strong>GitHub Repository:</strong> View source code and report issues</li>
            <li style="margin-bottom: 8px;"><strong>Documentation:</strong> Check the README.md for technical details</li>
            <li style="margin-bottom: 8px;"><strong>Support:</strong> Contact the administrator or check the logs for detailed error information</li>
            <li style="margin-bottom: 8px;"><strong>Donate:</strong> Support development via the <a href="/donate">Donate</a> page</li>
        </ul>
    </div>
</div>
{% endblock %}
